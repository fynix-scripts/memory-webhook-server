<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Memory 2.0</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="style.css" />
<link rel="icon" type="image/gif" href="logo/logo.gif" />
</head>
<body class="ansogninger-page">
<div class="background-slider" aria-hidden="true">
  <div class="slide active" style="background-image:url('https://cdn.discordapp.com/attachments/1403153259115577587/1403748908835803156/bg.png?ex=6898ae8c&is=68975d0c&hm=db5d3654bcdee96fdc10bb83a5028a5033f75f54ea2db3ee883999efa47b6593&')"></div>
  <div class="slide" style="background-image:url('https://images.unsplash.com/photo-1509395176047-4a66953fd231?auto=format&fit=crop&w=1600&q=80')"></div>
  <div class="slide" style="background-image:url('https://images.unsplash.com/photo-1505765051643-3821d6a19a5b?auto=format&fit=crop&w=1600&q=80')"></div>
</div>
<div class="background-overlay"></div>
<div class="site-wrapper">
  <header class="site-header" role="banner">
    <div class="header-container">
      <a class="logo-link" href="index.html">
        <img src="logo/logo.gif" alt="Memory 2.0" class="logo-image" />
        <span class="logo-text">Memory 2.0</span>
      </a>
      <nav class="main-nav" role="navigation" aria-label="Hovednavigation">
        <a class="nav-link" href="regler.html">Regler</a>
        <a class="nav-link active" href="ansogninger.html">Ansøgninger</a>
        <a class="nav-link" href="om.html">Om Serveren</a>
        <a class="nav-link" href="donationer.html">Donationer</a>
      </nav>
      <div class="header-actions">
        <a class="user-profile-link" href="mine-ansogninger.html" title="Mine ansøgninger">
          <img class="user-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" alt="Avatar" />
          <div class="user-info">
            <span class="user-name">Gæst</span>
            <span class="user-status">Ikke logget ind</span>
          </div>
        </a>
        <a class="cta-button" id="discordBtn" href="https://discord.gg/pCzWqbzgaR" target="_blank" rel="noopener noreferrer">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"></polygon></svg>
          Tilslut Discord
        </a>
        <button class="logout-btn" id="loginBtn">Log ind</button>
        <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Åben menu">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="18" x2="20" y2="18"></line></svg>
        </button>
      </div>
    </div>
    <nav class="mobile-nav" id="mobileNav" aria-hidden="true">
      <a class="nav-link" href="regler.html">Regler</a>
      <a class="nav-link active" href="ansogninger.html">Ansøgninger</a>
      <a class="nav-link" href="om.html">Om Serveren</a>
      <a class="nav-link" href="donationer.html">Donationer</a>
    </nav>
  </header>

  <main>
<div class="ansogninger-wrapper">
<form id="staffForm" class="ansogninger-form">

  <!-- STEP 1 -->
  <div class="form-step" id="step1">
    <h2>Ansøg om at blive staff</h2>
    <p>Udfyld nedenstående formular for at sende din ansøgning til Memory 2.0 staff teamet.</p>

    <label for="navn">Dit fulde navn:</label>
    <input type="text" id="navn" name="navn" required>

    <label for="discord">Discord brugernavn f.eks (tonnana):</label>
    <input type="text" id="discord" name="discord" required>

    <label for="alder">Alder 16+:</label>
    <input type="number" id="alder" name="alder" required>

    <label for="aktivitet">Hvor meget staff aktivitet kan vi forvente af dig om ugen?</label>
    <textarea id="aktivitet" name="aktivitet" required></textarea>

    <label for="om">Lidt om dig selv? (Hvordan du er som person):</label>
    <textarea id="om" name="om"></textarea>

    <label for="regler">Beskriv 5 valgfrie regler, med hvad de betyder og gerne nogle eksempler på dem.:</label>
    <textarea id="regler" name="regler"></textarea>

    <button type="button" class="next-btn">Fortsæt</button>
  </div>

  <!-- STEP 2 -->
  <div class="form-step hidden" id="step2">

    <label for="hvorfor">Hvorfor vil du gerne være staff? (100+ ord):</label>
    <textarea id="hvorfor" name="hvorfor"></textarea>

    <label for="kompetencer">Hvilke erfaringer samt kompetencer har du? nævn gerne server og rank:</label>
    <textarea id="kompetencer" name="kompetencer"></textarea>

    <label for="bidrag">Hvad er dine styrker, og hvad kan du bidrage med?</label>
    <textarea id="bidrag" name="bidrag"></textarea>

    <label for="vdm">Du ser en der laver vdm, hvad gør du?</label>
    <textarea id="vdm" name="vdm"></textarea>

    <label for="scene">Du er i scenarie med en, der begynder at bryde sin fearrp, hvad gør du?</label>
    <textarea id="scene" name="scene"></textarea>

    <label for="modder">Der er mistanke om modder på serveren, fra flere spillere og ting der sker på serveren.. Hvad gør du?</label>
    <textarea id="modder" name="modder"></textarea>

    <div class="form-buttons">
      <button type="button" class="prev-btn">Tilbage</button>
      <button type="button" class="next-btn">Fortsæt</button>
    </div>
  </div>

  <!-- STEP 3 -->
  <div class="form-step hidden" id="step3">
    <label for="spørg">Er du indforstået ved, hvis du spørger ind til din ansøgning, bliver den afvist? Ja/Nej</label>
    <textarea id="spørg" name="spørg"></textarea>

    <div class="form-buttons">
      <button type="button" class="prev-btn">Tilbage</button>
      <button type="submit" class="submit-btn">Send ansøgning</button>
    </div>
    <p id="formStatus"></p>
  </div>

</form>
</div>
  </main>
</div>

<div id="notification" class="notification hidden"></div>

<script>
  const mobileMenuBtn = document.getElementById('mobileMenuBtn');
  const mobileNav = document.getElementById('mobileNav');

  function closeMobileNav() {
    mobileNav.classList.remove('is-open');
    mobileNav.setAttribute('aria-hidden', 'true');
  }

  function checkScreenSize() {
    if (window.innerWidth >= 768) {
      closeMobileNav();
    }
  }

  mobileMenuBtn.addEventListener('click', () => {
    mobileNav.classList.toggle('is-open');
    mobileNav.setAttribute('aria-hidden', String(!mobileNav.classList.contains('is-open')));
  });

  window.addEventListener('resize', checkScreenSize);
  checkScreenSize();

  const loginBtn = document.getElementById('loginBtn');
  const userAvatar = document.querySelector('.user-avatar');
  const userNameSpan = document.querySelector('.user-name');
  const userStatusSpan = document.querySelector('.user-status');

  const DISCORD_CLIENT_ID = '1403793707085594705';
  const REDIRECT_URI = 'https://pghosting.dk//callback.html';

  loginBtn.addEventListener('click', () => {
    const storedUser = JSON.parse(localStorage.getItem('discordUser'));
    if (storedUser) {
      localStorage.removeItem('discordUser');
      updateUserUI(null);
    } else {
      const oauthUrl = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=code&scope=identify%20email`;
      window.location.href = oauthUrl;
    }
  });

  function updateUserUI(user) {
    if (user) {
      userAvatar.src = user.avatarUrl || 'https://cdn.discordapp.com/embed/avatars/0.png';
      userNameSpan.textContent = user.username || 'Bruger';
      userStatusSpan.textContent = '';
      loginBtn.textContent = 'Log ud';
    } else {
      userAvatar.src = 'https://cdn.discordapp.com/embed/avatars/0.png';
      userNameSpan.textContent = '';
      userStatusSpan.textContent = 'Ikke logget ind';
      loginBtn.textContent = 'Log ind';
    }
  }

  const storedUser = JSON.parse(localStorage.getItem('discordUser'));
  updateUserUI(storedUser);

  const steps = document.querySelectorAll('.form-step');
  const nextBtns = document.querySelectorAll('.next-btn');
  const prevBtns = document.querySelectorAll('.prev-btn');

  let currentStep = 0;

  function showStep(step) {
    steps.forEach((s, i) => {
      s.classList.toggle('hidden', i !== step);
    });
    window.scrollTo(0, 0);
  }

  nextBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      if (currentStep < steps.length - 1) {
        currentStep++;
        showStep(currentStep);
      }
    });
  });

  prevBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
      }
    });
  });

  showStep(currentStep);

const form = document.getElementById('staffForm');

function showNotification(message, type = 'success') {
  const notification = document.getElementById('notification');
  notification.textContent = message;
  notification.className = 'notification show ' + type;
  
  setTimeout(() => {
    notification.className = 'notification hidden';
  }, 4000);
}

form.addEventListener('submit', async e => {
  e.preventDefault();

  const formData = new FormData(form);
  const data = {};
  formData.forEach((value, key) => {
    data[key] = value || 'Ikke udfyldt';
  });

  try {
    const res = await fetch('/send-application', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const response = await res.json();
    if (response.success) {
      showNotification('Din ansøgning er sendt!', 'success');
      form.reset();
      currentStep = 0;
      showStep(currentStep);
    } else {
      showNotification('Noget gik galt: ' + response.error, 'error');
    }
  } catch (err) {
    showNotification('Fejl ved afsendelse', 'error');
  }
});
</script>
</body>
</html>
